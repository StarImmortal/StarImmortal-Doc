---
title: 数据库设计规范
---

# MySQL数据库设计规范

## 数据库命名设计规范

- 所有数据库对象名称必须使用小写字母并用下划线分割
- 所有数据库对象名称禁止使用MySQL保留关键字
- 数据库对象的命名要做到见名识义，并且最好不要超过32个字符
- 临时库表必须以tmp为前缀并以日期为后缀
- 备份库，备份表必须以bak为前缀并以日期为后缀
- 所以存储相同的列名和列类型必须一致

## 数据库基本设计规范

- 所有表必须使用Innodb存储引擎
- 数据库和表的字符集统一使用UTF-8
- 所有表和字段都需要添加注释
- 尽量控制单表数据量的大小，建议控制在500万以内
- 谨慎使用MySQL分区表
- 尽量做到冷热数据分离，减少表的宽度
- 禁止在表中建立预留字段
- 禁止在数据库中存储图片、文件等二进制数据
- 禁止在线上做数据库压力测试
- 禁止从开发环境、测试环境直连生产环境数据库

## 索引设计规范

- 限制每张表的索引数量，建议单张表索引不超过5个
- 每个Innodb表必须有一个主键
  * 不使用UUID、MD5、HASH、字符串列作为主键
  * 不使用更新频繁的列作为主键，不使用多列主键
  * 主键建议选择使用自增ID值
- 常见索引建议
  * SELECT、UPDATE、DELETE语句中的WHERE从句中的列
  * 包含在ORDER BY、GROUP BY、DISTINCT中的字段
  * 多表JOIN的关联列
- 如何选择索引列的顺序
  * 区分度最高的列放在联合索引的最左侧
  * 尽量把字段长度小的列放在联合索引的最左侧
  * 使用最频繁的列放到联合索引的左侧
- 对于频繁的查询优先考虑使用覆盖索引
- 尽量避免使用外键
  * 不建议使用外键约束，但一定在表与表之间的关联键上建立索引

## 数据库字段设计规范

- 优先选择符合存储需要的最小的数据类型
  * 将字符串转换为数字类型存储
    ```
     INET_ATON('255.255.255.255') = 4294967295
     INET_NTOA(4294967295) = '255.255.255.255'
    ```
  * 对于非负数据采用无符号整型进行存储
  * VARCHAR(N)中的N代表的是字符数，而不是字节数
  * 使用UTF8存储汉字Varchar(255)=765字节
- 避免使用TEXT、BLOB数据类型
- 避免使用ENUM数据类型
- 尽可能把所有列定义为NOT NULL
- 使用TIMESTAMP或DATETIME类型存储时间
- 同财务相关的金额类数据，必须使用decimal类型

## 数据库SQL开发规范

- 建议使用预编译语句进行数据库操作
- 避免数据类型的隐式转换
- 避免双%号的查询条件
- 使用left join 或 not exists 来优化 not in操作
- 禁止使用SELECT * 必须使用 SELECT <字段列表> 查询
- 禁止使用不含字段列表的INSERT语句
- 避免使用子查询，可以把子查询优化为join操作
- 避免使用JOIN关联太多的表
- 减少同数据库的交互次数
- 使用 in 代替 or
- 禁止使用 order by rand()进行随机排序
- WHERE从句中禁止对列进行函数转换和计算
- 在明显不会有重复值时使用UNION ALL而不是UNION
- 拆分复杂的大SQL为多个小SQL

## 数据库操作的行为规范

- 超过100万行的批量写操作，要分批多次进行操作
- 对于大表使用pt-online-schema-change修改表结构
- 禁止为程序使用的账号赋予super权限
- 对于程序连接数据库账号，遵循权限最小原则

<RightMenu />